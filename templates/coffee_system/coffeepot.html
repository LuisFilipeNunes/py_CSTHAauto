<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Controle da Cafeteira</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='coffee_style.css') }}">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Controle da Cafeteira</h1>
    </div>
    <div class="content">
      <div class="menu">
        
        <button id="filledButton" class="toggle-button" onclick="toggleFilled()">Cafeteira foi preenchida?</button>
        <button id="confirmButton" class="toggle-button" onclick="confirmCoffee()" disabled>Programar caf√©</button>
        <label>
          Hora Desejada:
          <input type="time" id="coffeeTime" name="hora">
        </label>
        <button id="manualControlButton" class="toggle-button" onclick="toggleManualControl()">Controle Manual</button>

<!-- Add this part for programar desligamento -->
<label>
    Hora de Desligamento:
    <input type="time" id="shutdownTime" name="hora_desligamento">
</label>
      </div>
    </div>
    <div class="footer">
      <a href="{{ url_for('index') }}">voltar ao menu anterior</a>
  </div>
  </div>
  <script>

    function toggleFilled() {
      var filledButton = document.getElementById("filledButton");
      var confirmButton = document.getElementById("confirmButton");
    
      if (filledButton) {
        filledButton.classList.toggle("active");
    
        // Enable or disable the confirmButton based on the filledButton state
        if (filledButton.classList.contains("active")) {
          confirmButton.disabled = false; // Enable the confirmButton
        } else {
          confirmButton.disabled = true; // Disable the confirmButton
        }
      }
    }
    
    var manualControlFlag = false;

    function toggleManualControl() {
        var manualControlButton = document.getElementById("manualControlButton");
        if (manualControlButton) {
            manualControlButton.classList.toggle("active");
            // Update the manualControlFlag based on the button state
            manualControlFlag = manualControlButton.classList.contains("active");
        }
    }


    function confirmCoffee() {
      var coffeeTime = document.getElementById("coffeeTime").value;
      var filledButton = document.getElementById("filledButton");
      var confirmButton = document.getElementById("confirmButton");
      var shutdownTime = document.getElementById("shutdownTime").value;
      var shutdownConfig = false;
      if(shutdownTime){

        var shutdownConfig = true;
      }
      // Check if the filledButton is clicked (contains the "active" class)
      if (filledButton && filledButton.classList.contains("active")) {
        if (coffeeTime) {
          // Enable the confirmButton and proceed with the confirmation logic
          confirmButton.disabled = false;
          fetch("/confirm-coffee", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              coffeeTime: coffeeTime,
              manualControl: manualControlFlag,
              shutdownFlag: shutdownConfig,
              shutdownTime: shutdownTime,
            }),
          })
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.text();
            })
            .then(data => {
              console.log(data); // Log the response from the server
            })
            .catch(error => {
              console.error("Error:", error);
              // Handle server-side errors here
            });
        } else {
          // Add the shake animation class to visually notify the user
          confirmButton.classList.add("shake");
    
          // Remove the shake class and enable the confirmButton after the animation completes
          setTimeout(() => {
            confirmButton.classList.remove("shake");
            confirmButton.disabled = false; // Enable the confirmButton
          }, 500);
    
          console.log("Error: Please set a time before confirming coffee!");
        }
      } else {
        // If filledButton is not clicked, disable the confirmButton
        confirmButton.disabled = true;
      }
    }
    
    
    
    
  </script>
</body>
</html>
